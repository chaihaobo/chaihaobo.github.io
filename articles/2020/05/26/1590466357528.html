<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="theme-color" content="#3b3e43"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"/><title>docker-compose.yml 配置文件详解 - chaihaobo </title><meta name="description" content=""/><meta property="og:description" content=""/>    <meta name="keywords" content="java,数据"/><link rel="dns-prefetch" href="https://chaihaobo.github.io"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://chaihaobo.github.io"><link rel="icon" type="image/png" href="https://modoo.oss-cn-beijing.aliyuncs.com/u%3D2355059236%2C1504112045%26fm%3D26%26gp%3D0.jpg"/><link rel="apple-touch-icon" href="https://modoo.oss-cn-beijing.aliyuncs.com/u%3D2355059236%2C1504112045%26fm%3D26%26gp%3D0.jpg"><link rel="shortcut icon" type="image/x-icon" href="https://modoo.oss-cn-beijing.aliyuncs.com/u%3D2355059236%2C1504112045%26fm%3D26%26gp%3D0.jpg"><meta name="copyright" content="B3log"/><meta http-equiv="Window-target" content="_top"/><meta property="og:locale" content="zh_CN"/><meta property="og:title" content="docker-compose.yml 配置文件详解 - chaihaobo "/><meta property="og:site_name" content="chaihaobo "/><meta property="og:url"      content="https://chaihaobo.github.io/articles/2020/05/26/1590466357528.html?"/><meta property="og:image" content="https://modoo.oss-cn-beijing.aliyuncs.com/u%3D2355059236%2C1504112045%26fm%3D26%26gp%3D0.jpg"/><link rel="search" type="application/opensearchdescription+xml" title="docker-compose.yml 配置文件详解 - chaihaobo " href="/opensearch.xml"><link href="https://chaihaobo.github.io/rss.xml" title="RSS" type="application/rss+xml" rel="alternate"/><link rel="manifest" href="https://chaihaobo.github.io/manifest.json">        <link rel="canonical" href="https://chaihaobo.github.io/articles/2020/05/26/1590466357528.html">        <link rel="stylesheet" href="https://chaihaobo.github.io/skins/solo-nexmoe/css/base.css?1590205324215"/>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/css/mdui.min.css">
        <link rel="stylesheet" href="https://chaihaobo.github.io/skins/solo-nexmoe/css/font-icon.css?1590205324215">
    </head>
<body class="mdui-drawer-body-left mdui-loaded">
<div id="nexmoe-background">
    <canvas id="c_n1" class="nexmoe-bg"></canvas>
<div class="mdui-appbar mdui-shadow-0">
    <div class="mdui-toolbar">
        <a href="#" mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon">
            <i class="mdui-icon  iconfont solo-list"></i>
        </a>
        <div class="mdui-toolbar-spacer"></div>
        <a href="/" title="chaihaobo " class="mdui-btn mdui-btn-icon">
            <img src="https://modoo.oss-cn-beijing.aliyuncs.com/u%3D2355059236%2C1504112045%26fm%3D26%26gp%3D0.jpg" title="chaihaobo " alt="chaihaobo "></a>
        </a>
    </div>
</div>
</div>
<div id="nexmoe-header">
<div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="https://chaihaobo.github.io/" title="chaihaobo ">
            <img src="https://modoo.oss-cn-beijing.aliyuncs.com/u%3D2355059236%2C1504112045%26fm%3D26%26gp%3D0.jpg" title="chaihaobo " alt=""></a>
    </div>
    <div class="nexmoe-count">
        <div>
            <span>文章</span>
            6
        </div>
        <div>
            <span class="ft-gray">浏览</span>
            <b class="notb" data-uvstaturl="https://chaihaobo.github.io">0</b>
        </div>
    </div>
    <div class="list-content">
        <ul class="nexmoe-list mdui-list header__nav" mdui-collapse="{accordion: true}">
            <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="https://chaihaobo.github.io/" title="chaihaobo ">
                <i class="mdui-list-item-icon iconfont solo-home"></i>
                <div class="mdui-list-item-content">回到首页</div>
            </a>
            <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="https://chaihaobo.github.io/links.html"
               title="友情链接 - chaihaobo ">
                <i class="mdui-list-item-icon iconfont solo-list"></i>
                <div class="mdui-list-item-content">友情链接</div>
            </a>
            <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="https://chaihaobo.github.io/tags.html"
               title="标签 - chaihaobo ">
                <i class="mdui-list-item-icon iconfont solo-tags"></i>
                <div class="mdui-list-item-content">标签</div>
            </a>
                <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/my-github-repos"
                   title="我的开源" target="_self">
                    <i class="mdui-list-item-icon iconfont solo-/images/github-icon.png"></i>
                    <div class="mdui-list-item-content">我的开源</div>
                </a>
        </ul>
    </div>
    <aside id="nexmoe-sidebar">

        <div class="nexmoe-widget-wrap">
            <h3 class="nexmoe-widget-title">功能按钮</h3>
            <div class="nexmoe-widget nexmoe-social features">
                <a href="https://chaihaobo.github.io/search" title="搜索">
                    <i class="mdui-list-item-icon iconfont solo-search"></i>
                    <div class="mdui-list-item-content">搜索</div>
                </a>
                <a href="https://chaihaobo.github.io/rss.xml" title="RSS">
                    <i class="mdui-list-item-icon iconfont solo-rss"></i>
                </a>
                    <a href="https://chaihaobo.github.io/start" title="开始使用">
                        <i class="mdui-list-item-icon iconfont solo-login"></i>
                        <div class="mdui-list-item-content"> 开始使用</div>
                    </a>
            </div>
        </div>

        <div class="nexmoe-widget-wrap">
            <h3 class="nexmoe-widget-title">社交按钮</h3>
            <div class="nexmoe-widget nexmoe-social">
            </div>
        </div>

            <div class="nexmoe-widget-wrap">
                <h3 class="nexmoe-widget-title">标签</h3>
                <div class="nexmoe-widget tagcloud">
                        <a rel="tag"
                           href="https://chaihaobo.github.io/tags/%E5%BE%85%E5%88%86%E7%B1%BB"
                           title="标签:待分类 - chaihaobo "
                           class="mdui-ripple">
                            待分类</a>
                        <a rel="tag"
                           href="https://chaihaobo.github.io/tags/elastic"
                           title="标签:elastic - chaihaobo "
                           class="mdui-ripple">
                            elastic</a>
                        <a rel="tag"
                           href="https://chaihaobo.github.io/tags/%E5%BC%80%E6%BA%90"
                           title="标签:开源 - chaihaobo "
                           class="mdui-ripple">
                            开源</a>
                        <a rel="tag"
                           href="https://chaihaobo.github.io/tags/GitHub"
                           title="标签:GitHub - chaihaobo "
                           class="mdui-ripple">
                            GitHub</a>
                        <a rel="tag"
                           href="https://chaihaobo.github.io/tags/Linux"
                           title="标签:Linux - chaihaobo "
                           class="mdui-ripple">
                            Linux</a>
                        <a rel="tag"
                           href="https://chaihaobo.github.io/tags/Flink"
                           title="标签:Flink - chaihaobo "
                           class="mdui-ripple">
                            Flink</a>
                </div>
            </div>



            <div class="nexmoe-widget-wrap">
                <h3 class="nexmoe-widget-title">存档</h3>
                <div class="nexmoe-widget">
                    <ul class="category-list">
                                <li class="category-list-item">
                                    <a href="https://chaihaobo.github.io/archives/2020/05"
                                       title="2020 年 05 月 存档 - chaihaobo ">
                                        2020 年 05 月</a>
                                    <span class="category-list-count">6</span>
                                </li>
                    </ul>
                </div>
            </div>

    </aside>
    <div class="nexmoe-copyright">
        © 2020 <a href="https://chaihaobo.github.io">chaihaobo </a> <br/>
         <br>
        Powered by <a href="https://solo.b3log.org" target="_blank">Solo</a> <br>
        Theme <a rel="friend" href="https://github.com/InkDP/solo-nexmoe" target="_blank">solo-nexmoe</a>
        by <a rel="friend" href="https://www.inkdp.cn" target="_blank">InkDP</a>
    </div>
</div>
</div>
<div id="nexmoe-content">
    <div class="nexmoe-primary">
        <main id="pjax" class="fn__flex-1">
            
            <div class="nexmoe-post">
                <div class="nexmoe-post-cover">
                    <img src="https://b3logfile.com/bing/20171204.jpg?imageView2/1/w/1280/h/720/interlace/1/q/100" alt="docker-compose.yml 配置文件详解"
                         data-src="https://b3logfile.com/bing/20171204.jpg?imageView2/1/w/1280/h/720/interlace/1/q/100" class=" ls-is-cached lazyloaded">
                    <h1>docker-compose.yml 配置文件详解</h1>
                </div>
                <div class="nexmoe-post-meta">
                <span>
                    <i class="nexmoefont iconfont solo-calendarl"></i>2020年05月26日
                </span>

                    <span>
                    <i class="nexmoefont iconfont solo-heat"></i>
                    <b class="notb" data-uvstaturl="https://chaihaobo.github.io/articles/2020/05/26/1590466357528.html">0</b> °C
                </span>
                        <span>
                    <a class="nexmoefont iconfont solo-tag "
                       href="https://chaihaobo.github.io/tags/%E5%BE%85%E5%88%86%E7%B1%BB">待分类</a>
                </span>

                </div>
                <article>
                    <div class="vditor-reset">
                        <h2 id="toc_h2_0">一. 前言</h2>
<p>关于 <code>docker compos</code> 技术可以查看官方文档 <a href="https://docs.docker.com/compose/" target="_blank">Docker Compose</a></p>
<p>以下的内容是确立在已经下载好 <code>Docker</code> 以及 <code>Docker Compos</code>，可参看 <code>Docker Compos</code>的官方安装教程 <a href="https://docs.docker.com/compose/install/" target="_blank">Install Docker Compose</a></p>
<h2 id="toc_h2_1">二. Docker Compose 配置文件的构建参数说明</h2>
<p>首先，官方提供了一个 <code>yaml</code>Docker Compose 配置文件的标准例子</p>
<pre><code>version: "3"
services:

  redis:
    image: redis:alpine
    ports:
      - "6379"
    networks:
      - frontend
    deploy:
      replicas: 2
      update_config:
        parallelism: 2
        delay: 10s
      restart_policy:
        condition: on-failure

  db:
    image: postgres:9.4
    volumes:
      - db-data:/var/lib/postgresql/data
    networks:
      - backend
    deploy:
      placement:
        constraints: [node.role == manager]

  vote:
    image: dockersamples/examplevotingapp_vote:before
    ports:
      - 5000:80
    networks:
      - frontend
    depends_on:
      - redis
    deploy:
      replicas: 2
      update_config:
        parallelism: 2
      restart_policy:
        condition: on-failure  

  result:
    image: dockersamples/examplevotingapp_result:before
    ports:
      - 5001:80
    networks:
      - backend
    depends_on:
      - db
    deploy:
      replicas: 1
      update_config:
        parallelism: 2
        delay: 10s
      restart_policy:
        condition: on-failure
  
  worker:
    image: dockersamples/examplevotingapp_worker
    networks:
      - frontend
      - backend
    deploy:
      mode: replicated
      replicas: 1
      labels: [APP=VOTING]
      restart_policy:
        condition: on-failure
        delay: 10s
        max_attempts: 3
        window: 120s
      placement:
        constraints: [node.role == manager]

  visualizer:
    image: dockersamples/visualizer:stable
    ports:
      - "8080:8080"
    stop_grace_period: 1m30s
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock"
    deploy:
      placement:
        constraints: [node.role == manager]

networks:
  frontend:
  backend:

volumes:
  db-data:
</code></pre>
<p>此文件配置了多个服务，关于此配置文件的各个语句含义就需要弄懂配置选项的含义了</p>
<h2 id="toc_h2_2">文件配置</h2>
<p><code>compos</code> 文件是一个定义服务、 网络和卷的 <code>YAML</code> 文件 。Compose 文件的默认路径是 <code>./docker-compose.yml</code></p>
<blockquote>
<p>提示：可以是用 <code>.yml</code> 或 <code>.yaml</code>作为文件扩展名</p>
</blockquote>
<p>服务定义包含应用于为该服务启动的每个容器的配置，就像传递命令行参数一样 <code>docker container creat</code>。同样，网络和卷的定义类似于 <code>docker network creat</code> 和 docker volume create。</p>
<p>正如 docker container create 在 Dockerfile 指定选项，如 CMD、 EXPOSE、VOLUME、ENV，在默认情况下，你不需要再次指定它们docker-compose.yml。</p>
<p>可以使用 Bash 类 <code>${VARIABLE}</code> 语法在配置值中使用环境变量。</p>
<h2 id="toc_h2_3">配置选项</h2>
<h3 id="toc_h3_4">１.bulid</h3>
<p>服务除了可以基于指定的镜像，还可以基于一份 <code>Dockerfil</code>，在使用 <code>up</code> 启动之时执行构建任务，这个构建标签就是 <code>buil</code>，它可以指定 <code>Dockerfil</code> 所在文件夹的路径。<code>Compos</code>将会利用它自动构建这个镜像，然后使用这个镜像启动服务容器</p>
<pre><code>build: /path/to/build/dir
</code></pre>
<p>也可以是相对路径</p>
<pre><code>build: ./dir
</code></pre>
<p>设定上下文根目录，然后以该目录为准指定 Dockerfile</p>
<pre><code>build:
  context: ../
  dockerfile: path/of/Dockerfile
</code></pre>
<p>例子</p>
<pre><code>version: '3'
services:
  webapp:
    build: ./dir
</code></pre>
<p>如果 <code>context</code> 中有指定的路径，并且可以选定 Dockerfile 和 args。那么 <code>arg</code>这个标签，就像 Dockerfile 中的 ARG 指令，它可以在构建过程中指定环境变量，但是在构建成功后取消，在 <code>docker-compose.yml</code>文件中也支持这样的写法：</p>
<pre><code>version: '3'
services:
  webapp:
    build:
      context: ./dir
      dockerfile: Dockerfile-alternate
      args:
        buildno: 1
</code></pre>
<p>与 <code>ENV</code> 不同的是，<code>ARG</code>可以为空值</p>
<pre><code>args:
  - buildno
  - password
</code></pre>
<p>如果要指定 <code>imag</code>以及 <code>buil</code> ，选项格式为</p>
<pre><code>build: ./dir
image: webapp:tag
</code></pre>
<p>这会在 <code>./dir</code>目录生成一个名为 <code>webaapp</code> 和标记为 <code>tag</code> 的镜像</p>
<h3 id="toc_h3_5">2. context</h3>
<p><code>context</code>选项可以是 <code>Dockerfil</code>的文件路径，也可以是到链接到 <code>git</code>仓库的 <code>url</code></p>
<p>当提供的值是相对路径时，它被解析为相对于撰写文件的路径，此目录也是发送到 Docker 守护进程的 <code>context</code></p>
<pre><code>build:
  context: ./dir
</code></pre>
<h3 id="toc_h3_6">３. dockerfile</h3>
<p>使用此 <code>dockerfil</code>文件来构建，必须指定构建路径</p>
<pre><code>build:
  context: .
  dockerfile: Dockerfile-alternate
</code></pre>
<h3 id="toc_h3_7">４. args</h3>
<p>添加构建参数，这些参数是仅在构建过程中可访问的环境变量</p>
<p>首先， 在 <code>Dockerfil</code>中指定参数：</p>
<pre><code>ARG buildno
ARG password
RUN echo "Build number: $buildno"
RUN script-requiring-password.sh "$password"
</code></pre>
<p>然后指定 <code>buil</code>下的参数,可以传递映射或列表</p>
<pre><code>build:
  context: .
  args:
    buildno: 1
    password: secret
</code></pre>
<p>或</p>
<pre><code>build:
  context: .
  args:
    - buildno=1
    - password=secret
</code></pre>
<p>指定构建参数时可以省略该值，在这种情况下，构建时的值默认构成运行环境中的值</p>
<pre><code>args:
  - buildno
  - password
</code></pre>
<blockquote>
<p>Note： YAML 布尔值（true，false，yes，no，on，off）必须使用引号括起来，以为了能够正常被解析为字符串</p>
</blockquote>
<h3 id="toc_h3_8">５. cache_from</h3>
<p>编写缓存解析镜像列表</p>
<pre><code>build:
  context: .
  cache_from:
    - alpine:latest
    - corp/web_app:3.14
</code></pre>
<h3 id="toc_h3_9">6. labels</h3>
<p>使用 Docker标签 将元数据添加到生成的镜像中，可以使用数组或字典。</p>
<p>建议使用反向 DNS 标记来防止签名与其他软件所使用的签名冲突</p>
<pre><code>build:
  context: .
  labels:
    com.example.description: "Accounting webapp"
    com.example.department: "Finance"
    com.example.label-with-empty-value: ""
</code></pre>
<p>或</p>
<pre><code>build:
  context: .
  labels:
    - "com.example.description=Accounting webapp"
    - "com.example.department=Finance"
    - "com.example.label-with-empty-value"
</code></pre>
<h3 id="toc_h3_10">7.shm_size</h3>
<p>设置容器 <code>/dev/shm</code>分区的大小，值为表示字节的整数值或表示字符的字符串</p>
<pre><code>build:
  context: .
  shm_size: '2gb'
</code></pre>
<p>或</p>
<pre><code>build:
  context: .
  shm_size: 10000000
</code></pre>
<h3 id="toc_h3_11">8. target</h3>
<p>根据对应的 <code>Dockerfil</code>构建指定 <code>Stag</code></p>
<pre><code>build:
    context: .
    target: prod
</code></pre>
<h3 id="toc_h3_12">9. cap_add、cap_drop</h3>
<p>添加或删除容器功能，可查看 <a href="http://man7.org/linux/man-pages/man7/capabilities.7.html" target="_blank">man 7 capabilities</a></p>
<pre><code>cap_add:
  - ALL
cap_drop:
  - NET_ADMIN
  - SYS_ADMIN
</code></pre>
<blockquote>
<p>Note:当用(Version 3) Compose 文件在群集模式下部署堆栈时，该选项被忽略。因为 <code>docker stack</code> 命令只接受预先构建的镜像</p>
</blockquote>
<h3 id="toc_h3_13">10. command</h3>
<p>覆盖容器启动后默认执行的命令</p>
<pre><code>command: bundle exec thin -p 3000
</code></pre>
<p>该命令也可以是一个列表，方法类似于 dockerfile:</p>
<pre><code>command: ["bundle", "exec", "thin", "-p", "3000"]
</code></pre>
<h3 id="toc_h3_14">11. configs</h3>
<p>使用服务 <code>configs</code>配置为每个服务赋予相应的访问权限，支持两种不同的语法。</p>
<blockquote>
<p>Note: 配置必须存在或在 configs 此堆栈文件的顶层中定义，否则堆栈部署失效</p>
</blockquote>
<h4 id="toc_h4_15">1.SHORT 语法</h4>
<p>SHORT 语法只能指定配置名称，这允许容器访问配置并将其安装在 <code>/&lt;config_name&gt;</code> 容器内，源名称和目标装入点都设为配置名称。</p>
<pre><code>version: "3.3"

services:
  redis:
    image: redis:latest
    deploy:
      replicas: 1
    configs:
      - my_config
      - my_other_config
configs:
  my_config:
    file: ./my_config.txt
  my_other_config:
    external: true
</code></pre>
<p>以上实例使用 SHORT 语法将 <code>redis</code> 服务访问授予 <code>my_config</code> 和 <code>my_other_config</code> ,并被 <code>my_other_config</code> 定义为外部资源，这意味着它已经在 Docker 中定义。可以通过 <code>docker config creat</code>命令或通过另一个堆栈部署。如果外部部署配置都不存在，则堆栈部署会失败并出现 <code>config not foun</code>错误。</p>
<blockquote>
<p>Note: config 定义仅在 3.3 版本或在更高版本的撰写文件格式中受支持，YAML 的布尔值（true, false, yes, no, on, off）必须要使用引号引起来（单引号、双引号均可），否则会当成字符串解析。</p>
</blockquote>
<h4 id="toc_h4_16">2. LONG 语法</h4>
<p>LONG 语法提供了创建服务配置的更加详细的信息</p>
<p><code>source:Docker</code>中存在的配置的名称</p>
<p><code>target</code>:要在服务的任务中装载的文件的路径或名称。如果未指定则默认为 <code>/&lt;source&gt;</code></p>
<p>uid 和 gid:在服务的任务容器中拥有安装的配置文件的数字 UID 或 GID。如果未指定，则默认为在Linux上。Windows不支持。</p>
<p>mode:在服务的任务容器中安装的文件的权限，以八进制表示法。例如，<code>0444</code>代表文件可读的。默认是 <code>0444</code>。如果配置文件无法写入，是因为它们安装在临时文件系统中，所以如果设置了可写位，它将被忽略。可执行位可以设置。如果您不熟悉 UNIX 文件权限模式，<a href="http://permissions-calculator.org/" target="_blank">Unix Permissions Calculator</a></p>
<p>下面示例在容器中将 <code>my_config</code>名称设置为 <code>redis_config</code>，将模式设置为 <code>0440</code>（group-readable）并将用户和组设置为 <code>103</code>。该　<code>redis</code>　服务无法访问 <code>my_other_config</code>配置。</p>
<pre><code>version: "3.3"
services:
  redis:
    image: redis:latest
    deploy:
      replicas: 1
    configs:
      - source: my_config
        target: /redis_config
        uid: '103'
        gid: '103'
        mode: 0440
configs:
  my_config:
    file: ./my_config.txt
  my_other_config:
    external: true
</code></pre>
<p>可以同时授予多个配置的服务相应的访问权限，也可以混合使用 LONG 和 SHORT 语法。定义配置并不意味着授予服务访问权限。</p>
<h3 id="toc_h3_17">12. cgroup_parent</h3>
<p>可以为容器选择一个可选的父 <code>cgroup</code></p>
<pre><code>cgroup_parent: m-executor-abcd
</code></pre>
<blockquote>
<p>注意：当 使用（Version 3）Compose 文件在群集模式下部署堆栈时，忽略此选项</p>
</blockquote>
<h3 id="toc_h3_18">13. container_name</h3>
<p>为自定义的容器指定一个名称，而不是使用默认的名称</p>
<pre><code>container_name: my-web-container
</code></pre>
<p>因为 docker 容器名称必须是唯一的，所以如果指定了一个自定义的名称，不能扩展一个服务超过 1 个容器</p>
<h3 id="toc_h3_19">14. credential_spec</h3>
<p>为托管服务账户配置凭据规范，此选项仅适用于 Windows 容器服务</p>
<p>在 <code>credential_sp</code> 上的配置列表格式为 <code>file://&lt;filename&gt;</code>或 <code>registry://&lt;value-name&gt;</code></p>
<p>使用 <code>file:</code>应该注意引用的文件必须存在于　<code>CredentialSpecs,docker</code>数据目录的子目录中。在 Windows 上，该目录默认为 <code>C:\ProgramData\Docker\</code>。以下示例从名为 <code>C:\ProgramData\Docker\CredentialSpecs\my-credential-spec.json</code>的文件加载凭证规范：</p>
<pre><code>credential_spec:
  file: my-credential-spec.json
</code></pre>
<p>使用 <code>registry:</code> 将从守护进程主机上的 Windows 注册表中读取凭据规范。其注册表值必须位于：</p>
<pre><code>HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Virtualization\Containers\CredentialSpecs
</code></pre>
<p>下面的示例通过 <code>my-credential-sp</code>注册表中指定的值加载凭证规范：</p>
<pre><code>credential_spec:
  registry: my-credential-spec
</code></pre>
<h3 id="toc_h3_20">15. deploy</h3>
<p>指定与部署和运行服务相关的配置</p>
<pre><code>version: '3'
services:
  redis:
    image: redis:alpine
    deploy:
      replicas: 6
      update_config:
        parallelism: 2
        delay: 10s
      restart_policy:
        condition: on-failure
</code></pre>
<p>这里有几个子选项</p>
<h4 id="toc_h4_21">1. endpoint_mode</h4>
<p>指定连接到群组外部客户端服务发现方法</p>
<p><code>endpoint_mode:vip</code>：Docker 为该服务分配了一个虚拟 IP(VIP),作为客户端的 “前端“ 部位用于访问网络上的服务。</p>
<p><code>endpoint_mode: dnsrr</code>: DNS轮询（DNSRR）服务发现不使用单个虚拟 IP。Docker为服务设置 DNS 条目，使得服务名称的 DNS 查询返回一个 IP 地址列表，并且客户端直接连接到其中的一个。如果想使用自己的负载平衡器，或者混合 Windows 和 Linux 应用程序，则 DNS 轮询调度（round-robin）功能就非常实用。</p>
<pre><code>version: "3.3"
services:

  wordpress:
    image: wordpress
    ports:
      - 8080:80
    networks:
      - overlay
    deploy:
      mode: replicated
      replicas: 2
      endpoint_mode: vip

  mysql:
    image: mysql
    volumes:
       - db-data:/var/lib/mysql/data
    networks:
       - overlay
    deploy:
      mode: replicated
      replicas: 2
      endpoint_mode: dnsrr 

volumes:
  db-data:
  
networks:
  overlay:
</code></pre>
<p>相关信息：<a href="https://docs.docker.com/engine/swarm/#swarm-mode-key-concepts-and-tutorial" target="_blank">Swarm 模式 CLI 命令</a> 、<a href="https://docs.docker.com/network/overlay/" target="_blank">Configure 服务发现</a></p>
<h4 id="toc_h4_22">2.labels</h4>
<p>指定服务的标签，这些标签仅在服务上设置。</p>
<pre><code>version: "3"
services:
  web:
    image: web
    deploy:
      labels:
        com.example.description: "This label will appear on the web service"
</code></pre>
<p>通过将 <code>deploy</code> 外面的 <code>labels</code> 标签来设置容器上的 <code>labels</code></p>
<pre><code>version: "3"
services:
  web:
    image: web
    labels:
      com.example.description: "This label will appear on all containers for the web service"
</code></pre>
<h4 id="toc_h4_23">3.mode</h4>
<p><code>global</code>:每个集节点只有一个容器</p>
<p><code>replicat</code>:指定容器数量（默认）</p>
<pre><code>version: '3'
services:
  worker:
    image: dockersamples/examplevotingapp_worker
    deploy:
      mode: global
</code></pre>
<h4 id="toc_h4_24">4. placement</h4>
<p>指定 <code>constraints</code>和 <code>preferences</code></p>
<pre><code>version: '3'
services:
  db:
    image: postgres
    deploy:
      placement:
        constraints:
          - node.role == manager
          - engine.labels.operatingsystem == ubuntu 14.04
        preferences:
          - spread: node.labels.zone
</code></pre>
<h4 id="toc_h4_25">５.replicas</h4>
<p>如果服务是 <code>replicat</code>（默认)，需要指定运行的容器数量</p>
<pre><code>version: '3'
services:
  worker:
    image: dockersamples/examplevotingapp_worker
    networks:
      - frontend
      - backend
    deploy:
      mode: replicated
      replicas: 6
</code></pre>
<h4 id="toc_h4_26">6. resources</h4>
<p>配置资源限制</p>
<pre><code>version: '3'
services:
  redis:
    image: redis:alpine
    deploy:
      resources:
        limits:
          cpus: '0.50'
          memory: 50M
        reservations:
          cpus: '0.25'
          memory: 20M
</code></pre>
<p>此例子中，<code>redis</code>服务限制使用不超过 50M 的内存和 0.50（50％）可用处理时间（CPU），并且 保留 20M 了内存和 0.25 CPU时间</p>
<h4 id="toc_h4_27">7. restart_policy</h4>
<p>配置容器的重新启动，代替 <code>restart</code></p>
<p><code>condition</code>:值可以为 none 、on-failure 以及 any(默认)</p>
<p><code>delay</code>: 尝试重启的等待时间，默认为 0</p>
<p><code>max_attempts</code>:在放弃之前尝试重新启动容器次数（默认：从不放弃）。如果重新启动在配置中没有成功 window，则此尝试不计入配置 <code>max_attempts</code> 值。例如，如果 <code>max_attempts</code>值为 2，并且第一次尝试重新启动失败，则可能会尝试重新启动两次以上。</p>
<p><code>windows</code>:在决定重新启动是否成功之前的等时间，指定为持续时间（默认值：立即决定）。</p>
<pre><code>version: "3"
services:
  redis:
    image: redis:alpine
    deploy:
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 120s
</code></pre>
<h4 id="toc_h4_28">8. update_config</h4>
<p>配置更新服务，用于无缝更新应用（rolling update)</p>
<p><code>parallelism</code>：一次性更新的容器数量</p>
<p><code>delay</code>：更新一组容器之间的等待时间。</p>
<p><code>failure_action</code>：如果更新失败，可以执行的的是 <code>continu</code>、<code>rollback</code>或 <code>paus</code>（默认）</p>
<p><code>monitor</code>：每次任务更新后监视失败的时间(ns|us|ms|s|m|h)（默认为0）</p>
<p><code>max_failure_rati</code>：在更新期间能接受的失败率</p>
<p><code>order</code>：更新次序设置，<code>top-first</code>（旧的任务在开始新任务之前停止）、<code>start-first</code>（新的任务首先启动，并且正在运行的任务短暂重叠）（默认 stop-first）</p>
<pre><code>version: '3.4'
services:
  vote:
    image: dockersamples/examplevotingapp_vote:before
    depends_on:
      - redis
    deploy:
      replicas: 2
      update_config:
        parallelism: 2
        delay: 10s
        order: stop-first
</code></pre>
<p>不支持 ****Docker stack desploy ****的几个子选项</p>
<p>build、cgroup_parent、container_name、devices、tmpfs、external_links、inks、network_mode、restart、security_opt、stop_signal、sysctls、userns_mode</p>
<h3 id="toc_h3_29">16. devices</h3>
<p>设置映射列表，与 Docker 客户端的 <code>--devi</code> 参数类似 :</p>
<pre><code>devices:
  - "/dev/ttyUSB0:/dev/ttyUSB0"
</code></pre>
<h3 id="toc_h3_30">17. depends_on</h3>
<p>此选项解决了启动顺序的问题</p>
<p>在使用 Compose 时，最大的好处就是少打启动命令，但是一般项目容器启动的顺序是有要求的，如果直接从上到下启动容器，必然会因为容器依赖问题而启动失败。例如在没启动数据库容器的时候启动了应用容器，这时候应用容器会因为找不到数据库而退出，为了避免这种情况我们需要加入一个标签，就是 depends_on，这个标签解决了容器的依赖、启动先后的问题。</p>
<p>指定服务之间的依赖关系，有两种效果</p>
<p><code>docker-compose up</code>以依赖顺序启动服务，下面例子中 <code>redis</code> 和 <code>db</code>服务在 <code>web</code>启动前启动</p>
<p><code>docker-compose up SERVICE</code> 自动包含 <code>SERVICE</code>的依赖性，下面例子中，例如下面容器会先启动 <code>redis</code>和 <code>db</code></p>
<p>两个服务，最后才启动 web 服务：</p>
<pre><code>version: '3'
services:
  web:
    build: .
    depends_on:
      - db
      - redis
  redis:
    image: redis
  db:
    image: postgres
</code></pre>
<p>注意的是，默认情况下使用 <code>docker-compose up web</code>这样的方式启动 web 服务时，也会启动 redis 和 db 两个服务，因为在配置文件中定义了依赖关系</p>
<h3 id="toc_h3_31">18. dns</h3>
<p>自定义 DNS 服务器，与 --dns 具有一样的用途，可以是单个值或列表</p>
<pre><code>dns: 8.8.8.8
dns:
  - 8.8.8.8
  - 9.9.9.9
</code></pre>
<h3 id="toc_h3_32">19. dns_search</h3>
<p>自定义 DNS 搜索域，可以是单个值或列表</p>
<pre><code>dns_search: example.com
dns_search:
  - dc1.example.com
  - dc2.example.com
</code></pre>
<h3 id="toc_h3_33">20. tmpfs</h3>
<p>挂载临时文件目录到容器内部，与 run 的参数一样效果，可以是单个值或列表</p>
<pre><code>tmpfs: /run
tmpfs:
  - /run
  - /tmp
</code></pre>
<h3 id="toc_h3_34">21. entrypoint</h3>
<p>在 Dockerfile 中有一个指令叫做 ENTRYPOINT 指令，用于指定接入点。在 <code>docker-compose.yml</code>中可以定义接入点，覆盖 Dockerfile 中的定义：</p>
<pre><code>entrypoint: /code/entrypoint.sh
</code></pre>
<p><code>entrypoint</code>也可以是一个列表，方法类似于 <a href="https://docs.docker.com/engine/reference/builder/#entrypoint" target="_blank">dockerfile</a></p>
<pre><code>entrypoint:
    - php
    - -d
    - zend_extension=/usr/local/lib/php/extensions/no-debug-non-zts-20100525/xdebug.so
    - -d
    - memory_limit=-1
    - vendor/bin/phpunit
</code></pre>
<h3 id="toc_h3_35">21. env_file</h3>
<p>从文件中添加环境变量。可以是单个值或是列表</p>
<p>如果已经用 <code>docker-compose -f FILE</code> 指定了 Compose 文件，那么 env_file 路径值为相对于该文件所在的目录</p>
<p>但 <a href="https://docs.docker.com/compose/compose-file/#environment" target="_blank">environment</a> 环境中的设置的变量会会覆盖这些值，无论这些值未定义还是为 None</p>
<pre><code>env_file: .env
</code></pre>
<p>或者根据 <code>docker-compose.yml</code>设置多个：</p>
<pre><code>env_file:
  - ./common.env
  - ./apps/web.env
  - /opt/secrets.env
</code></pre>
<p>环境配置文件 env_file 中的声明每行都是以 VAR=VAL 格式，其中以 # 开头的被解析为注释而被忽略</p>
<p><strong>注意环境变量配置列表的顺序</strong>,例如下面例子</p>
<p><em>docker_compose.yml</em></p>
<pre><code>services:
  some-service:
    env_file:
      - a.env
      - b.env
</code></pre>
<p><em>a.env</em> 文件</p>
<pre><code># a.env
VAR=1
</code></pre>
<p><em>b.env</em>文件</p>
<p>对于在文件 <code>a.env</code> 中指定的相同变量但在文件 <code>b.env</code>中分配了不同的值，如果 <code>b.env</code> 像下面列在 <code>a.env</code>之后，则刚在 <code>a.env</code> 设置的值被 <code>b.env</code> 相同变量的值覆盖，此时 $VAR 值为 hello。此外，这里所说的环境变量是对宿主机的 Compose 而言的，如果在配置文件中有 build 操作，这些变量并不会进入构建过程中，如果要在构建中使用变量还是首选 <code>arg</code>标签</p>
<h3 id="toc_h3_36">22. environment</h3>
<p>添加环境变量，可以使用数组或字典。与上面的 env_file 选项完全不同，反而和 arg 有几分类似，这个标签的作用是设置镜像变量，它可以保存变量到镜像里面，也就是说启动的容器也会包含这些变量设置，这是与 arg 最大的不同。</p>
<p>一般 <code>arg</code>标签的变量仅用在构建过程中。而 <code>environment</code> 和 <code>Dockerfil</code> 中的 ENV 指令一样会把变量一直保存在镜像、容器中，类似 <code>docker run -</code> 的效果</p>
<pre><code>environment:
  RACK_ENV: development
  SHOW: 'true'
  SESSION_SECRET:
</code></pre>
<p>或</p>
<pre><code>environment:
  - RACK_ENV=development
  - SHOW=true
  - SESSION_SECRET
</code></pre>
<h3 id="toc_h3_37">23. expose</h3>
<p>暴露端口，但不映射到宿主机，只被连接的服务访问。这个标签与 <code>Dockerfil</code> 中的 <code>EXPOSE</code> 指令一样，用于指定暴露的端口，但是只是作为一种参考，实际上 <code>docker-compose.yml</code> 的端口映射还得 <code>ports</code>这样的标签</p>
<pre><code>expose:
- "3000"
- "8000"
</code></pre>
<h3 id="toc_h3_38">24. external_links</h3>
<p>链接到 <code>docker-compose.yml</code>外部的容器，甚至 并非 Compose 项目文件管理的容器。参数格式跟 <code>links</code> 类似</p>
<blockquote>
<p>在使用Docker过程中，会有许多单独使用 <code>docker run</code> 启动的容器的情况，为了使 Compose 能够连接这些不在 <code>docker-compose.yml</code>配置文件中定义的容器，那么就需要一个特殊的标签，就是 <code>external_links</code>，它可以让Compose 项目里面的容器连接到那些项目配置外部的容器（前提是外部容器中必须至少有一个容器是连接到与项目内的服务的同一个网络里面）。</p>
</blockquote>
<p>格式如下</p>
<pre><code>external_links:
- redis_1
- project_db_1:mysql
- project_db_1:postgresql
</code></pre>
<h3 id="toc_h3_39">25. extra_hosts</h3>
<p>添加主机名的标签，就是往 <code>/etc/hosts</code>文件中添加一些记录，与 Docker 客户端 中的 <code>--add-host</code> 类似：</p>
<pre><code>extra_hosts:
- "somehost:162.242.195.82"
- "otherhost:50.31.209.229"
</code></pre>
<p>具有 IP 地址和主机名的条目在 <code>/etc/hosts</code> 内部容器中创建。启动之后查看容器内部 <code>hosts</code> ，例如：</p>
<pre><code>162.242.195.82  somehost
50.31.209.229   otherhost
</code></pre>
<h3 id="toc_h3_40">26.healthcheck</h3>
<p>用于检查测试服务使用的容器是否正常</p>
<pre><code>healthcheck:
  test: ["CMD", "curl", "-f", "http://localhost"]
  interval: 1m30s
  timeout: 10s
  retries: 3
  start_period: 40s
</code></pre>
<p><code>interval</code>，<code>timeout</code> 以及 <code>start_peri</code>都定为持续时间</p>
<p><code>test</code>必须是字符串或列表，如果它是一个列表，第一项必须是 NONE，CMD 或 CMD-SHELL ；如果它是一个字符串，则相当于指定CMD-SHELL 后跟该字符串。</p>
<pre><code># Hit the local web app
test: ["CMD", "curl", "-f", "http://localhost"]
# As above, but wrapped in /bin/sh. Both forms below are equivalent.
test: ["CMD-SHELL", "curl -f http://localhost || exit 1"]
test: curl -f https://localhost || exit 1
</code></pre>
<p>如果需要禁用镜像的所有检查项目，可以使用 <code>disable:tru</code>,相当于 <code>test:["NONE"]</code></p>
<pre><code>healthcheck:
  disable: true
</code></pre>
<h3 id="toc_h3_41">27. image</h3>
<p>从指定的镜像中启动容器，可以是存储仓库、标签以及镜像 ID</p>
<pre><code>image: redis
image: ubuntu:14.04
image: tutum/influxdb
image: example-registry.com:4000/postgresql
image: a4bc65fd
</code></pre>
<p>如果镜像不存在，Compose 会自动拉去镜像</p>
<h3 id="toc_h3_42">28. isolation</h3>
<p>Linux 上仅仅支持 <code>default</code> 值</p>
<h3 id="toc_h3_43">29. labels</h3>
<p>使用 Docker 标签将元数据添加到容器，可以使用数组或字典。与 Dockerfile 中的 <code>LABELS</code>类似：</p>
<pre><code>labels:
  com.example.description: "Accounting webapp"
  com.example.department: "Finance"
  com.example.label-with-empty-value: ""

labels:
  - "com.example.description=Accounting webapp"
  - "com.example.department=Finance"
  - "com.example.label-with-empty-value"
</code></pre>
<h3 id="toc_h3_44">30.links</h3>
<p>链接到其它服务的中的容器，可以指定服务名称也可以指定链接别名（SERVICE：ALIAS)，与 Docker 客户端的 <code>--link</code>有一样效果，会连接到其它服务中的容器</p>
<pre><code>web:
  links:
   - db
   - db:database
   - redis
</code></pre>
<p>使用的别名将会自动在服务容器中的 <code>/etc/hosts</code>里创建。例如：</p>
<pre><code>172.12.2.186  db
172.12.2.186  database
172.12.2.187  redis
</code></pre>
<p>相应的环境变量也将被创建</p>
<h3 id="toc_h3_45">31. logging</h3>
<p>配置日志服务</p>
<pre><code>logging:
  driver: syslog
  options:
    syslog-address: "tcp://192.168.0.42:123"
</code></pre>
<p>该 <code>driver</code>值是指定服务器的日志记录驱动程序，默认值为 <code>json-fil</code>,与 <code>--log-diver</code>选项一样</p>
<pre><code>driver: "json-file"
driver: "syslog"
driver: "none"
</code></pre>
<blockquote>
<p>注意：只有驱动程序 <code>json-fil</code>和 <code>journal</code>驱动程序可以直接从 <code>docker-compose up</code>和 <code>docker-compose logs</code>获取日志。使用任何其他方式不会显示任何日志。</p>
</blockquote>
<p>对于可选值，可以使用 options 指定日志记录中的日志记录选项</p>
<pre><code>driver: "syslog"
options:
  syslog-address: "tcp://192.168.0.42:123"
</code></pre>
<p>默认驱动程序 json-file 具有限制存储日志量的选项，所以，使用键值对来获得最大存储大小以及最小存储数量</p>
<pre><code>options:
  max-size: "200k"
  max-file: "10"
</code></pre>
<p>上面实例将存储日志文件，直到它们达到 <code>max-size:200kB</code>，存储的单个日志文件的数量由该 max-file 值指定。随着日志增长超出最大限制，旧日志文件将被删除以存储新日志<br>
<code>docker-compose.yml</code>限制日志存储的示例</p>
<pre><code>services:
  some-service:
    image: some-service
    logging:
      driver: "json-file"
      options:
        max-size: "200k"
        max-file: "10"
</code></pre>
<h3 id="toc_h3_46">32. network_mode</h3>
<p>网络模式，用法类似于 Docke 客户端的 <code>--net</code> 选项，格式为：<code>service:[service name]</code></p>
<pre><code>network_mode: "bridge"
network_mode: "host"
network_mode: "none"
network_mode: "service:[service name]"
network_mode: "container:[container name/id]"
</code></pre>
<p>可以指定使用服务或者容器的网络</p>
<h3 id="toc_h3_47">33. networks</h3>
<p>加入指定网络</p>
<pre><code>services:
  some-service:
    networks:
     - some-network
     - other-network
</code></pre>
<h3 id="toc_h3_48">34. aliases</h3>
<p>同一网络上的其他容器可以使用服务器名称或别名来连接到其他服务的容器</p>
<pre><code>services:
  some-service:
    networks:
      some-network:
        aliases:
         - alias1
         - alias3
      other-network:
        aliases:
         - alias2
</code></pre>
<p>下面实例中，提供 <code>web</code> 、<code>worker</code>以及 <code>db</code> 服务，伴随着两个网络 <code>new</code>和 <code>legacy</code>。</p>
<pre><code>version: '2'

services:
  web:
    build: ./web
    networks:
      - new
  worker:
    build: ./worker
    networks:
      - legacy
  db:
    image: mysql
    networks:
      new:
        aliases:
          - database
      legacy:
        aliases:
          - mysql

networks:
  new:
  legacy:
</code></pre>
<p>相同的服务可以在不同的网络有不同的别名</p>
<h3 id="toc_h3_49">35. ipv4_address、ipv6_address</h3>
<p>为服务的容器指定一个静态 IP 地址</p>
<pre><code>version: '2.1'

services:
  app:
    image: busybox
    command: ifconfig
    networks:
      app_net:
        ipv4_address: 172.16.238.10
        ipv6_address: 2001:3984:3989::10

 
networks:
  app_net:
    driver: bridge
    enable_ipv6: true
    ipam:
      driver: default
      config:
      -
        subnet: 172.16.238.0/24
      -
        subnet: 2001:3984:3989::/64
</code></pre>
<h3 id="toc_h3_50">36. PID</h3>
<pre><code>pid: "host"
</code></pre>
<p>将 PID 模式设置为主机 PID 模式，可以打开容器与主机操作系统之间的共享 PID 地址空间。使用此标志启动的容器可以访问和操作宿主机的其他容器，反之亦然。</p>
<h3 id="toc_h3_51">37. ports</h3>
<p>映射端口</p>
<h4 id="toc_h4_52">1. SHORT 语法</h4>
<p>可以使用 <code>HOST:CONTAINER</code>的方式指定端口，也可以指定容器端口（选择临时主机端口），宿主机会随机映射端口</p>
<pre><code>ports:
- "3000"
- "3000-3005"
- "8000:8000"
- "9090-9091:8080-8081"
- "49100:22"
- "127.0.0.1:8001:8001"
- "127.0.0.1:5000-5010:5000-5010"
- "6060:6060/udp"
</code></pre>
<blockquote>
<p>注意：当使用 <code>HOST:CONTAINER</code>格式来映射端口时，如果使用的容器端口小于 60 可能会得到错误得结果，因为 <code>YAML</code> 将会解析 <code>xx:yy</code> 这种数字格式为 <code>60</code>进制，所以建议采用字符串格式。</p>
</blockquote>
<h4 id="toc_h4_53">2. LONG 语法</h4>
<p>LONG 语法支持 SHORT 语法不支持的附加字段</p>
<p><code>targ</code>t：容器内的端口</p>
<p><code>publish</code>：公开的端口</p>
<p><code>protocol</code>： 端口协议（tcp 或 udp）</p>
<p><code>m</code>：通过host 用在每个节点还是哪个发布的主机端口或使用 <code>ingress</code>用于集群模式端口进行平衡负载，</p>
<pre><code>ports:
  - target: 80
    published: 8080
    protocol: tcp
    mode: host
</code></pre>
<h3 id="toc_h3_54">38. secrets</h3>
<p>通过 secrets为每个服务授予相应的访问权限</p>
<h4 id="toc_h4_55">1. SHORT 语法</h4>
<pre><code>version: "3.1"
services:
  redis:
    image: redis:latest
    deploy:
      replicas: 1
    secrets:
      - my_secret
      - my_other_secret
secrets:
  my_secret:
    file: ./my_secret.txt
  my_other_secret:
    external: true
</code></pre>
<h4 id="toc_h4_56">2.. LONG 语法</h4>
<p>LONG 语法可以添加其他选项</p>
<p><code>sour</code>：secret 名称</p>
<p><code>target</code>：在服务任务容器中需要装载在 <code>/run/secrets</code> 中的文件名称，如果 source 未定义，那么默认为此值</p>
<p><code>uid&amp;gi</code>：在服务的任务容器中拥有该文件的 <code>UID</code>或 <code>GID</code>。如果未指定，两者都默认为 0。</p>
<p><code>m</code>：以八进制表示法将文件装载到服务的任务容器中 <code>/run/secrets</code>的权限。例如，<code>0444</code>代表可读。</p>
<pre><code>version: "3.1"
services:

  redis:

    image: redis:latest

    deploy:

      replicas: 1

    secrets:

      - source: my_secret

        target: redis_secret

        uid: '103'

        gid: '103'

        mode: 0440

secrets:

  my_secret:

    file: ./my_secret.txt

  my_other_secret:

    external: true
</code></pre>
<h3 id="toc_h3_57">39. security_opt</h3>
<p>为每个容器覆盖默认的标签。简单说来就是管理全部服务的标签，比如设置全部服务的 user 标签值为 <code>USER</code></p>
<pre><code>security_opt:
  - label:user:USER
  - label:role:ROLE
</code></pre>
<h3 id="toc_h3_58">40. stop_grace_period</h3>
<p>在发送 SIGKILL 之前指定 <code>stop_signal</code>，如果试图停止容器（如果它没有处理 SIGTERM（或指定的任何停止信号）），则需要等待的时间</p>
<pre><code>stop_grace_period: 1s
stop_grace_period: 1m30s
</code></pre>
<p>默认情况下，stop 在发送SIGKILL之前等待10秒钟容器退出</p>
<h4 id="toc_h4_59">41. stop_signal</h4>
<p>设置另一个信号来停止容器。在默认情况下使用的 <code>SIGTERM</code>来停止容器。设置另一个信号可以使用 <code>stop_signal</code>标签：</p>
<pre><code>stop_signal: SIGUSR1
</code></pre>
<h3 id="toc_h3_60">42. sysctls</h3>
<p>在容器中设置的内核参数，可以为数组或字典</p>
<pre><code>sysctls:
  net.core.somaxconn: 1024
  net.ipv4.tcp_syncookies: 0

sysctls:
  - net.core.somaxconn=1024
  - net.ipv4.tcp_syncookies=0
</code></pre>
<h3 id="toc_h3_61">43. ulimits</h3>
<p>覆盖容器的默认限制，可以单一地将限制值设为一个整数，也可以将 <code>soft/har</code>限制指定为映射</p>
<pre><code>ulimits:
  nproc: 65535
  nofile:
    soft: 20000
    hard: 40000
</code></pre>
<ol start="44">
<li>userns_mode</li>
</ol>
<pre><code>userns_mode: "host"
</code></pre>
<h3 id="toc_h3_62">45. volumes</h3>
<p>挂载一个目录或者一个已存在的数据卷容器，可以直接使用 <code>HOST:CONTAINER</code>这样的格式，或者使用 <code>HOST:CONTAINER:r</code> 这样的格式，后者对于容器来说，数据卷是只读的，这样可以有效保护宿主机的文件系统</p>
<pre><code>version: "3.2"
services:
  web:
    image: nginx:alpine
    volumes:
      - type: volume
        source: mydata
        target: /data
        volume:
          nocopy: true
      - type: bind
        source: ./static
        target: /opt/app/static

  db:
    image: postgres:latest
    volumes:
      - "/var/run/postgres/postgres.sock:/var/run/postgres/postgres.sock"
      - "dbdata:/var/lib/postgresql/data"

volumes:
  mydata:
  dbdata:
</code></pre>
<p>Compose 的数据卷指定路径可以是相对路径，使用 . 或者 .. 来指定相对目录。</p>
<p>数据卷的格式可以是下面多种形式：</p>
<pre><code>volumes:
  # 只是指定一个路径，Docker 会自动在创建一个数据卷（这个路径是容器内部的）。
  - /var/lib/mysql
  # 使用绝对路径挂载数据卷
  - /opt/data:/var/lib/mysql
  # 以 Compose 配置文件为中心的相对路径作为数据卷挂载到容器。
  - ./cache:/tmp/cache
  # 使用用户的相对路径（~/ 表示的目录是 /home/&lt;用户目录&gt;/ 或者 /root/）。
  - ~/configs:/etc/configs/:ro
  # 已经存在的命名的数据卷。
  - datavolume:/var/lib/mysql
</code></pre>
<p>如果你不使用宿主机的路径，可以指定一个 <code>volume_driver</code></p>
<pre><code>volume_driver: mydriver
</code></pre>
<h4 id="toc_h4_63">1. SHORT 语法</h4>
<p>可以选择在主机（HOST:CONTAINER）或访问模式（HOST:CONTAINER:ro）上指定路径。</p>
<p>可以在主机上挂载相对路径，该路径相对于正在使用的 Compose 配置文件的目录进行扩展。相对路径应始终以 <code>.</code>或 <code>..</code>开头</p>
<pre><code>volumes:
  # Just specify a path and let the Engine create a volume
  - /var/lib/mysql
  # Specify an absolute path mapping
  - /opt/data:/var/lib/mysql
  # Path on the host, relative to the Compose file
  - ./cache:/tmp/cache
  # User-relative path
  - ~/configs:/etc/configs/:ro
  # Named volume
  - datavolume:/var/lib/mysql
</code></pre>
<h4 id="toc_h4_64">2. LONG 语法</h4>
<p>LONG 语法有些附加字段</p>
<p><code>typ</code>：安装类型，可以为 <code>volum</code>、<code>bin</code>或 <code>tmpfs</code></p>
<p><code>sour</code>：安装源，主机上用于绑定安装的路径或定义在顶级 <code>volumes</code>密钥中卷的名称 ,不适用于 <code>tmpfs</code> 类型安装。</p>
<p><code>target</code>：卷安装在容器中的路径</p>
<p><code>read_only</code>：标志将卷设置为只读</p>
<p><code>bin</code>：配置额外的绑定选项</p>
<p><code>propagation</code>：用于绑定的传播模式</p>
<p><code>volum</code>：配置额外的音量选项</p>
<p><code>nocopy</code>：创建卷时禁止从容器复制数据的标志</p>
<p><code>tmpfs</code>：配置额外的 <code>tmpfs</code>选项</p>
<p><code>siz</code>：<code>tmpfs</code> 的大小，以字节为单位</p>
<pre><code>version: "3.2"
services:
  web:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - type: volume
        source: mydata
        target: /data
        volume:
          nocopy: true
      - type: bind
        source: ./static
        target: /opt/app/static

networks:
  webnet: 

volumes:
  mydata:
</code></pre>
<h3 id="toc_h3_65">46. volumes_from</h3>
<p>从其它容器或者服务挂载数据卷，可选的参数是 :ro 或 :rw，前者表示容器只读，后者表示容器对数据卷是可读可写的（默认情况为可读可写的）。</p>
<pre><code>volumes_from:
  - service_name
  - service_name:ro
  - container:container_name
  - container:container_name:rw
</code></pre>
<h3 id="toc_h3_66">47. 用于服务、群集以及堆栈文件的卷</h3>
<p>在使用服务，群集和 docker-stack.yml 文件时，请记住支持服务的任务（容器）可以部署在群集中的任何节点上，并且每次更新服务时都可能是不同的节点。</p>
<p>在缺少指定源的命名卷的情况下，Docker 为支持服务的每个任务创建一个匿名卷。关联的容器被移除后，匿名卷不会保留。</p>
<p>如果希望数据持久存在，请使用可识别多主机的命名卷和卷驱动程序，以便可以从任何节点访问数据。或者，对该服务设置约束，以便将其任务部署在具有该卷的节点上。</p>
<p>下面一个例子，Docker Labs 中 <code>votingapp</code>示例的 <a href="https://github.com/docker/labs/blob/master/beginner/chapters/votingapp.md" target="_blank">docker-stack.yml</a>文件中定义了一个称为 <code>db</code>的服务。它被配置为一个命名卷来保存群体上的数据， 并且仅限于在节点上运行。下面是来自该文件的部分内容：<code>db postgres manager</code></p>
<pre><code>version: "3"
services:
  db:
    image: postgres:9.4
    volumes:
      - db-data:/var/lib/postgresql/data
    networks:
      - backend
    deploy:
      placement:
        constraints: [node.role == manager]
</code></pre>
<h3 id="toc_h3_67">48. restart</h3>
<p>默认值为 <code>n</code> ，即在任何情况下都不会重新启动容器；当值为 <code>always</code>时，容器总是重新启动；当值为 <code>on-failur</code>时，当出现 <code>on-failur</code>报错容器退出时，容器重新启动。</p>
<pre><code>restart: "no"
restart: always
restart: on-failure
restart: unless-stopped
</code></pre>
<h3 id="toc_h3_68">49. 其他选项</h3>
<p>关于标签：<code>cpu_shares</code>、<code>cpu_quota</code>、<code>cpus</code>、<code>domainnam</code>、<code>hostnam</code>、 <code>ip</code>、 <code>mac_address</code>、<code>privileg</code>、<code>read_only</code>、 <code>shm_siz</code>、<code>stdin_open</code>、<code>tty</code>、 <code>user</code>、 <code>working_dir</code></p>
<p>上面这些都是一个单值的标签，类似于使用 <code>docker run</code> 的效果</p>
<pre><code>cpu_shares: 73
cpu_quota: 50000
cpuset: 0,1

user: postgresql
working_dir: /code

domainname: [foo.com](http://foo.com/)
hostname: foo
ipc: host
mac_address: 02:42:ac:11:65:43

privileged: true


read_only: true
shm_size: 64M
stdin_open: true
tty: true
</code></pre>
<h3 id="toc_h3_69">50. 持续时间</h3>
<p>某些配置选项如 <code>check</code>的子选项 <code>interval</code>以及 <code>timeout</code>的设置格式</p>
<pre><code>2.5s
10s
1m30s
2h32m
5h34m56s
</code></pre>
<p>支持的单位有 <code>us</code>、<code>ms</code>、<code>s</code>、<code>m</code> 以及 <code>h</code></p>
<h3 id="toc_h3_70">51. 指定字节值</h3>
<p>某些选项如 <code>buli</code>的子选项 <code>shm_siz</code></p>
<pre><code>2b
1024kb
2048k
300m
1gb
</code></pre>
<p>支持的单位是 <code>b</code>，<code>k</code>，<code>m</code>以及 <code>g</code>，或 <code>kb</code>， <code>mb</code> 和 <code>gb</code>。目前不支持十进制值</p>
<h3 id="toc_h3_71">52. extends</h3>
<p>这个标签可以扩展另一个服务，扩展内容可以是来自在当前文件，也可以是来自其他文件，相同服务的情况下，后来者会有选择地覆盖原有配置</p>
<pre><code>extends:
  file: common.yml
  service: webapp
</code></pre>
<p>用户可以在任何地方使用这个标签，只要标签内容包含 file 和 service 两个值就可以了。file 的值可以是相对或者绝对路径，如果不指定 file 的值，那么 Compose 会读取当前 YML 文件的信息。</p>
<p>详细的文档可以查看官方文档：<a href="https://docs.docker.com/compose/compose-file/" target="_blank">撰写 docker-compose.yml 文件参考</a></p>
                    </div>
                </article>
                    <div class="nexmoe-post-copyright">
                        <i class="mdui-list-item-icon iconfont solo-about2"></i>
                        <hr>

标题：docker-compose.yml 配置文件详解<br>
作者：<a href="https://chaihaobo.github.io" target="_blank">chaihaobo</a><br>
地址：<a href="https://chaihaobo.github.io/articles/2020/05/26/1590466357528.html" target="_blank">https://chaihaobo.github.io/articles/2020/05/26/1590466357528.html</a><br>
概述：坐标南京,研发工程师
<!-- 签名档内可使用 HTML、JavaScript -->
<br>
                    </div>
            </div>
            <div class="post__toc">
<ul class="article__toc">
        <li class="toc__h2">
            <a href="#toc_h2_0">一. 前言</a>
        </li>
        <li class="toc__h2">
            <a href="#toc_h2_1">二. Docker Compose 配置文件的构建参数说明</a>
        </li>
        <li class="toc__h2">
            <a href="#toc_h2_2">文件配置</a>
        </li>
        <li class="toc__h2">
            <a href="#toc_h2_3">配置选项</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_4">１.bulid</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_5">2. context</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_6">３. dockerfile</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_7">４. args</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_8">５. cache_from</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_9">6. labels</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_10">7.shm_size</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_11">8. target</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_12">9. cap_add、cap_drop</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_13">10. command</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_14">11. configs</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_15">1.SHORT 语法</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_16">2. LONG 语法</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_17">12. cgroup_parent</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_18">13. container_name</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_19">14. credential_spec</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_20">15. deploy</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_21">1. endpoint_mode</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_22">2.labels</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_23">3.mode</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_24">4. placement</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_25">５.replicas</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_26">6. resources</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_27">7. restart_policy</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_28">8. update_config</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_29">16. devices</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_30">17. depends_on</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_31">18. dns</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_32">19. dns_search</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_33">20. tmpfs</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_34">21. entrypoint</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_35">21. env_file</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_36">22. environment</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_37">23. expose</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_38">24. external_links</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_39">25. extra_hosts</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_40">26.healthcheck</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_41">27. image</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_42">28. isolation</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_43">29. labels</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_44">30.links</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_45">31. logging</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_46">32. network_mode</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_47">33. networks</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_48">34. aliases</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_49">35. ipv4_address、ipv6_address</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_50">36. PID</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_51">37. ports</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_52">1. SHORT 语法</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_53">2. LONG 语法</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_54">38. secrets</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_55">1. SHORT 语法</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_56">2.. LONG 语法</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_57">39. security_opt</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_58">40. stop_grace_period</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_59">41. stop_signal</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_60">42. sysctls</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_61">43. ulimits</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_62">45. volumes</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_63">1. SHORT 语法</a>
        </li>
        <li class="toc__h4">
            <a href="#toc_h4_64">2. LONG 语法</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_65">46. volumes_from</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_66">47. 用于服务、群集以及堆栈文件的卷</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_67">48. restart</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_68">49. 其他选项</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_69">50. 持续时间</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_70">51. 指定字节值</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_71">52. extends</a>
        </li>
</ul>            </div>
                <div id="b3logsolocomments"></div>
                <div id="vcomment" style="padding: 30px 0;" data-name="chaihaobo" data-postId="1590466357528"></div>

            
        </main>

        <div class="back-to-top iconfont solo-gotop" onclick="Util.goTop()"></div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/js/mdui.min.js"></script>
<script type="text/javascript" src="https://chaihaobo.github.io/js/common.min.js?1590205324215"
        charset="utf-8"></script>
    <script type="text/javascript" src="https://chaihaobo.github.io/skins/solo-nexmoe/js/canvas.js?1590205324215"
            charset="utf-8"></script>

<script src="https://chaihaobo.github.io/skins/solo-nexmoe/js/app.js?1590205324215"></script>
<script src="https://cdn.jsdelivr.net/npm/lazysizes@5.1.0/lazysizes.min.js"></script>
<script type="text/javascript" src="https://chaihaobo.github.io/js/common.min.js?1590205324215"
        charset="utf-8"></script>
<script type="text/javascript" src="https://chaihaobo.github.io/skins/solo-nexmoe/js/common.js?1590205324215"
        charset="utf-8"></script>
<script>
  var Label = {
    servePath: "https://chaihaobo.github.io",
    staticServePath: "https://chaihaobo.github.io",
    luteAvailable: false,
    hljsStyle: 'github',
    langLabel: "zh_CN",
    version: "4.1.0",
    staticSite: true,
    showCodeBlockLn: false,
  }
</script>
<link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/kanbanniang@0.2.8/index.css"/>
<script async src="https://cdn.jsdelivr.net/npm/kanbanniang@0.2.8/index.js"></script>
<div class="solo-kanbanniang">
    <div class="solo-kanbanniang__tip"></div>
    <canvas id="soloKanbanniang" width="280" height="250"></canvas>
    <div class="solo-kanbanniang__tool">
        <svg id="soloKanbanniangHome" viewBox="0 0 32 32" width="100%" height="100%">
            <path d="M32 18.967l-16-12.42-16 12.42v-5.064l16-12.42 16 12.42zM28 18.516v12h-8v-8h-8v8h-8v-12l12-9z"></path>
        </svg>
        <svg id="soloKanbanniangRSS" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M320.364 768q0 45.728-32 77.728t-77.728 32-77.728-32-32-77.728 32-77.728 77.728-32 77.728 32 32 77.728zM612.94 838.272q1.152 16-9.728 27.424-10.272 12-26.848 12h-77.152q-14.272 0-24.576-9.44t-11.424-23.712q-12.576-130.848-105.44-223.712t-223.712-105.44q-14.272-1.152-23.712-11.424t-9.44-24.576V402.24q0-16.576 12-26.848 9.728-9.728 24.576-9.728h2.848q91.424 7.424 174.848 46.016t148 103.712q65.152 64.576 103.712 148t46.016 174.848z m292.576 1.152q1.152 15.424-10.272 26.848-10.272 11.424-26.272 11.424h-81.728q-14.848 0-25.44-10.016t-11.136-24.288q-6.848-122.848-57.728-233.44t-132.288-192-192-132.288-233.44-58.272q-14.272-0.576-24.288-11.136t-10.016-24.864V109.664q0-16 11.424-26.272 10.272-10.272 25.152-10.272h1.728q149.728 7.424 286.56 68.576t243.136 168q106.848 106.272 168 243.136t68.576 286.56z"></path>
        </svg>
        <svg id="soloKanbanniangChat" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M802.42709 96.163153H219.476155c-84.48109 0-154.896836 71.746044-154.896836 157.840888v393.119449c0 86.072331 70.415746 157.819398 154.896836 157.819399h214.038818V925.470963s22.526039 40.168862 64.767096 5.734608c30.965246-25.819039 126.721123-91.828428 171.775248-123.385145h132.369773c84.502579 0 154.896836-83.21526 154.896836-157.839865V251.125481c0-86.094844-70.394257-154.962328-154.896836-154.962328zM301.144176 518.002714c-39.427988 0-70.416769-31.576159-70.416769-71.746044 0-40.168862 30.988782-71.746044 70.416769-71.746044 39.426965 0 70.393233 31.577183 70.393234 71.746044 0 40.169885-30.966269 71.746044-70.393234 71.746044z m208.411657 0c-39.450501 0-70.415746-31.576159-70.415746-71.746044 0-40.168862 30.965246-71.746044 70.415746-71.746044 39.405475 0 70.394257 31.577183 70.394257 71.746044 0 40.169885-30.988782 71.746044-70.394257 71.746044z m211.203236 0c-39.426965 0-70.416769-31.576159-70.416769-71.746044 0-40.168862 30.988782-71.746044 70.416769-71.746044s70.415746 31.577183 70.415746 71.746044c-0.001023 40.169885-30.988782 71.746044-70.415746 71.746044z"></path>
        </svg>
        <svg id="soloKanbanniangChange" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M936.672 193.216l-226.88-64c-8.704-2.528-18.112-1.12-25.824 3.776-7.68 4.864-12.896 12.736-14.432 21.728C655.712 236.928 595.328 288 512 288c-71.424 0-142.464-103.296-163.776-143.104-7.136-13.28-22.528-19.84-37.024-15.68l-224 64C73.472 197.152 64 209.728 64 224v256a31.93 31.93 0 0 0 11.712 24.736c7.392 6.08 17.152 8.512 26.56 6.624L224 487.04V832c0 52.928 43.072 96 96 96h384c52.928 0 96-43.072 96-96V519.04l121.728 24.352c9.44 1.92 19.2-0.544 26.56-6.624C955.68 530.656 960 521.6 960 512V224c0-14.336-9.536-26.912-23.328-30.784zM672 800H352c-17.664 0-32-14.304-32-32s14.336-32 32-32h320c17.696 0 32 14.304 32 32s-14.304 32-32 32z"></path>
        </svg>
        <svg id="soloKanbanniangPhoto" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M898.048 258.048q23.552-1.024 46.592 9.216t40.96 27.136 28.672 39.424 10.752 46.08l0 390.144q0 24.576-10.752 47.104t-28.672 40.448-40.96 28.16-47.616 10.24l-697.344 0q-24.576 0-48.64-10.24t-42.496-27.648-29.696-40.448-11.264-48.64l0-381.952q0-22.528 10.752-45.568t28.672-41.472 39.936-30.208 44.544-11.776l63.488 0 13.312-83.968q3.072-20.48 18.432-32.768t34.816-12.288l456.704 0q19.456 0 34.304 10.752t16.896 34.304l14.336 83.968 54.272 0zM548.864 712.704q40.96 0 77.824-15.872t63.488-42.496 42.496-62.976 15.872-77.312-15.872-77.312-42.496-62.976-63.488-42.496-77.824-15.872-77.312 15.872-63.488 42.496-43.008 62.976-15.872 77.312 15.872 77.312 43.008 62.976 63.488 42.496 77.312 15.872z"></path>
        </svg>
        <svg id="soloKanbanniangGithub" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M1024 524.8c0 114.346667-32.554667 217.216-97.706667 308.565333-65.066667 91.306667-149.162667 154.538667-252.288 189.610667-11.989333 2.304-20.778667 0.682667-26.325333-4.778667a27.605333 27.605333 0 0 1-8.362667-20.48v-144.213333c0-44.16-11.52-76.501333-34.645333-97.024 25.344-2.730667 48.085333-6.826667 68.309333-12.288a268.629333 268.629333 0 0 0 62.72-26.666667 187.434667 187.434667 0 0 0 53.973334-45.44c14.421333-18.005333 26.197333-41.898667 35.328-71.765333 9.088-29.824 13.653333-64.128 13.653333-102.826667 0-55.125333-17.536-102.058667-52.650667-140.8 16.426667-41.429333 14.677333-87.893333-5.333333-139.392-12.458667-4.096-30.464-1.578667-54.016 7.509334a355.328 355.328 0 0 0-61.312 30.08L640 271.274667a462.336 462.336 0 0 0-128-17.749334c-43.989333 0-86.656 5.930667-128 17.749334a589.824 589.824 0 0 0-28.330667-18.432c-11.776-7.253333-30.336-16.042667-55.68-26.325334-25.344-10.24-44.416-13.312-57.301333-9.216-19.584 51.498667-21.12 97.962667-4.693333 139.434667-35.114667 38.698667-52.650667 85.632-52.650667 140.757333 0 38.698667 4.565333 72.874667 13.653333 102.485334 9.130667 29.610667 20.778667 53.546667 34.986667 71.765333 14.250667 18.218667 32.128 33.493333 53.674667 45.781333 21.546667 12.288 42.453333 21.205333 62.677333 26.666667 20.224 5.461333 43.008 9.557333 68.309333 12.288-17.749333 16.384-28.629333 39.850667-32.64 70.4a130.005333 130.005333 0 0 1-29.994666 10.24c-10.666667 2.261333-23.338667 3.413333-37.973334 3.413333-14.72 0-29.269333-4.906667-43.690666-14.677333-14.464-9.813333-26.794667-24.064-36.992-42.709333a109.226667 109.226667 0 0 0-32.341334-35.541334c-13.141333-9.130667-24.106667-14.592-33.024-16.426666l-13.312-2.048c-9.344 0-15.786667 1.024-19.328 3.072-3.584 2.090667-4.693333 4.693333-3.328 7.893333 1.28 3.157333 3.328 6.4 5.973334 9.557333 2.688 3.2 5.546667 5.930667 8.661333 8.192l4.693333 3.413334c9.770667 4.565333 19.413333 13.226667 29.013334 25.984 9.514667 12.757333 16.512 24.362667 20.992 34.858666l6.656 15.701334c5.76 17.322667 15.530667 31.317333 29.312 42.026666 13.781333 10.666667 28.672 17.536 44.672 20.48 16 2.986667 31.445333 4.565333 46.336 4.821334 14.890667 0.213333 27.221333-0.597333 36.992-2.389334l15.36-2.730666c0 17.28 0.085333 37.546667 0.298666 60.8l0.341334 36.906666a27.050667 27.050667 0 0 1-8.661334 20.48c-5.76 5.461333-14.677333 7.082667-26.666666 4.778667-103.125333-35.072-187.221333-98.261333-252.330667-189.610667C32.554667 742.058667 0 639.146667 0 524.8c0-95.232 22.869333-183.04 68.693333-263.466667A516.266667 516.266667 0 0 1 254.976 70.4C333.44 23.466667 419.114667 0 512 0c92.885333 0 178.56 23.466667 256.981333 70.4a516.266667 516.266667 0 0 1 186.368 190.976C1001.130667 341.802667 1024 429.653333 1024 524.842667z"></path>
        </svg>
        <svg id="soloKanbanniangClose" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M517.572566143763 1018.6748601482986C238.26554897656422 1018.6748601482986 11.897910175114305 792.2714997690043 11.897910175114305 513.0002041796496c0-279.3070171671984 226.36763880144977-505.71037754649296 505.6746559686481-505.71037754649296 279.2712955893538 0 505.6746559686481 226.40336037929444 505.6746559686481 505.71037754649296C1023.2472221124112 792.2714997690043 796.8795833109612 1018.6748601482986 517.572566143763 1018.6748601482986zM754.7281214542927 339.25044954334646c13.752807470184345-13.752807470184345 9.680547595895998-40.186775075214015-9.073280772537204-58.94060344364717l-2.143294670678079-2.1075730928334457c-18.7538283684332-18.7538283684332-45.15207439561819-22.861809820566194-58.90488186580257-9.073280772537204l-168.21291007038468 168.24863164822932-180.42968969324974-180.46541127109438c-13.967136937252159-13.967136937252159-40.72259874288353-9.823433907274534-59.72647815622916 9.216167083915742l-2.143294670678079 2.143294670678079c-19.039600991190277 19.003879413345654-23.111860865478626 45.75934121897699-9.180445506071107 59.655035000539876l180.42968969324974 180.46541127109438-176.07165719620428 176.03593561835962c-13.788529048028984 13.824250625873615-9.716269173740633 40.151053497369375 9.073280772537204 58.94060344364717l2.1075730928334457 2.1075730928334457c18.7538283684332 18.7538283684332 45.15207439561819 22.897531398410823 58.90488186580257 9.073280772537204l176.10737877404887-176.10737877404887 170.39192631890742 170.42764789675192c13.967136937252159 13.931415359407513 40.686877165038865 9.85915548511917 59.690756578384516-9.180445506071107l2.1790162485227142-2.1790162485227142c19.039600991190277-18.968157835501014 23.147582443323273-45.72361964113239 9.180445506071107-59.690756578384516l-170.39192631890742-170.42764789675192L754.7281214542927 339.25044954334646z"></path>
        </svg>
    </div>
</div>

<script>
    console.clear();
</script>
<script type="text/javascript">
    Util.addScript('https://chaihaobo.github.io/js/page.min.js?1590205324215', 'soloPageScript')
    var page = new Page({
        "commentContentCannotEmptyLabel": "评论内容只能为 2 到 500 个字符！",
        "oId": "1590466357528",
        "blogHost": "https://chaihaobo.github.io",
        "randomArticles1Label": "随机阅读：",
        "externalRelevantArticles1Label": "站外相关阅读："
    });
    $(document).ready(function () {
        page.load();
    page.tips.externalRelevantArticlesDisplayCount = "0";
    Skin.initArticle()
    });
</script>

</body>
</html>

<!-- Generated by Latke (https://github.com/88250/latke) in 22ms, 2020/05/26 12:15:42 -->